<!--B"H-->
<?<script> 
    var alias = request.user.info?.hosuhfuh?.alias;
    var username = request.user.info?.userId;
    $sd.alias=alias;
    $sd.username=username

    return `<script>var curAlias="${alias}"\n</script><br>`
</script>?>

<div class="awtsmoosDrop">
<div class="btn dropt" id="dropdownProfile">
    <?<script>return $sd.alias? "@"+$sd.alias:"Profile"</script>?> <span id="awtsDownIndicator" class="arrow">&#x25BC</span>
</div>
<div id="awtsmoosProfileDropContent" class="hidden dropdown-content">
    <div class="welcome">
        Welcome, <span class="highlight"><?<script>return $sd.username</script>?>!</span>
    </div>
    <?<script>
        if($sd.alias) {
            return /*html*/`
                <div class="currentAlias">
                You're current alias is: 
                <a href="/${$sd.alias? "@"+$sd.alias:"profile"}">
                    ${$sd.alias? "@"+$sd.alias:"Profile"}
                </a>
            </div>
            `;
        }
    </script>?>
    <div class="btn dropt" id="switchAlias">
        Switch Alias? <span id="aliasIndicator" class="arrow">&#x25BC</span>
    </div>
    <div id="aliasInfo" class="center hidden dropdown-content">
        <div class="center">
            <div class="loading-circle"></div>
        </div>
    </div>
    <hr>
    <div class="settings">
        <a href="/profile">Manage Your Aliases</a>
    </div>
    <?<script>
    
        return $a("logout.html");
    
    </script>?>
    <script>
        var aliasesGot = null;
        (() => {
            
            function dropdownify(content, arrow) {
                var hid = content.classList.contains("hidden")
                if(hid) {
                    content.classList.remove("hidden")
                    arrow.classList.add("right")
                } else {
                    content.classList.add("hidden")
                    arrow.classList.remove("right")
                    
                }
    
            }
            //switchAlias
            dropdownProfile.addEventListener("click", async () => {
                dropdownify(awtsmoosProfileDropContent, awtsDownIndicator)
            })
            switchAlias.addEventListener("click", async () => {
                dropdownify(aliasInfo, aliasIndicator);
    
                var oldHTML = aliasInfo.innerHTML;
                var aliases = aliasesGot;
                if(!aliases) {
                    try {
                        aliases = (await (await fetch(`/api/social/aliases/details?${
                            new URLSearchParams({
                                propertyMap: JSON.stringify({
                                    name: true,
                                    id: true
                                })
                            })
                        })`)).json());
                    } catch(e) {}
                }
                if(aliases) {
                    showAliases(aliases);
                     function showAliases(aliases) {
                        aliasInfo.innerHTML = "";
                         aliases = Array.from(aliases);
                        aliases.forEach(w => {
                            if(w.id == curAlias) {
                                 w.default = true;   
                            }
                            var h = document.createElement("div")
                            h.className = "aliasSelection"
    
                            var id = document.createElement("div")
                            h.className = "aliasId"
                            h.textContent = "@"+w.id;
                            
                            var p = document.createElement("div")
                            p.className = "aliasName"
                            p.textContent = w.name;
    
                            h.appendChild(p);
                            if(w.default) {
                                 h.classList.add("default")   
                            }
    
                            aliasInfo.appendChild(h);
                            h.addEventListener("click", async () => {
                                h.innerHTML = "Setting as default...";
                                var resp = (await (await fetch(`/api/social/alias/default`, {
                                    method: "POST",
                                    body: "alias="+w.id
                                })).json());
                                if(resp.success) {
                                    aliases.forEach(f => {
                                        if(f.id != w.id)
                                            f.default = false;
                                    })
                                    showAliases(aliases);
                                } else {
                                    h.innerHTML = "Couldn't make "+w.id+"default";
                                }
                                
                            })
                            
                            
                        })
                     }
                }
                console.log(aliases)
            })
        })()
    </script>
</div>
</div>
<style>

    #aliasInfo {
        
    }
     .awtsmoosDrop .dropt, {
           padding-right: 26px;
        }

  
    .awtsmoosDrop .currentAlias {
        padding:7px;
    }

    .awtsmoosDrop .currentAlias a {
        background:hsl(245deg 100% 50%);
    }

    .awtsmoosDrop .currentAlias a:hover {
        background:yellow;
    }

    .awtsmoosDrop .arrow.right {
        transform:rotate(270deg);
    }
    .awtsmoosDrop .arrow {
         position:absolute;
        padding:unset;
    }

        .awtsmoosDrop .dropdown-content {
            padding:26px;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 8765786576575875768767861;
        }

        .awtsmoosDrop .dropdown-content a {
            /*color: black;*/
            padding: 12px 16px;
            
            dtext-ecoration: unset;
            display: inline-block;
            /*background: unset;*/
            margin:7px;
            border:1px solid black;
        }
</style>
