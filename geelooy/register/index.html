<!--B"H-->
<?Awtsmoos
        return getT("bh.html");
    ?>
<html>
<head>
    <title>Register to Awtsmoos</title>
    
    <link href="../style/forms.css" type="text/css" rel="stylesheet">
</head>
<body>
    
  <div id="message">
    <h2>Register</h2>
    <form action="/register" method="POST">
        <div>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div>
            <button type="submit">Register</button>
        </div>
    </form>
    <div id="serverMessage">
        
    </div>
  </div>
  <script>
    //B"H
    var info;
    //<?Awtsmoos
        if(cookies.awtsmoosKey) {
            var BH = await getT("bh.html");
            var logout = await getT("logout.html")
            olam.replace = BH
            +`
            <link rel="stylesheet" type="text/css" href="/style/forms.css">
                You are already logged in! 
                ${logout}? Or click B"H at the top left to go home.
            `;

            return olam;
        }
        var registrar = require("./ayzarim/registrar.js")
        var result = await registrar.handleRegistration(this.request,$_POST)

        
        if(result.token) {
            setHeader("set-cookie",`awtsmoosKey=${result.token}; HttpOnly; `+
            "max-age="+(60*60*24*365));
            result.token = undefined;
        }

        olam.toychen = "info=\""+result.message+"\"";
        
   // ?>
   serverMessage.innerHTML = info
    </script>
</body>
</html>
