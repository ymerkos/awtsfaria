<h2>B"H</h2>
<script>
    // Function to handle the selection of the root directory
async function selectRootDirectory() {
    const dirHandle = await window.showDirectoryPicker();
    processDirectory(dirHandle);
}

// Function to process each directory
async function processDirectory(directoryHandle, parentSeriesId = 'root') {
    for await (const entry of directoryHandle.values()) {
        if (entry.kind === 'file') {
            const file = await entry.getFile();
            const content = await file.text();
            await createPost(file.name, content, parentSeriesId);
        } else if (entry.kind === 'directory') {
            const newSeriesId = await createSeries(entry.name, parentSeriesId);
            await processDirectory(entry, newSeriesId);
        }
    }
}

// Function to create a post on Awtsmoos
async function createPost(title, content, seriesId) {
    const response = await fetch("https://awtsmoos.com/api/social/heichelos/tanach/posts", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: `aliasId=sefarim&title=${encodeURIComponent(title)}&content=${encodeURIComponent(content)}&heichel=tanach&seriesId=${seriesId}`,
    });
    const responseData = await response.json();
    if (responseData.error) {
        console.error('Error creating post:', responseData.error);
    }
}

// Function to create a series on Awtsmoos
async function createSeries(title, parentSeriesId) {
    const response = await fetch("https://awtsmoos.com/api/social/heichelos/tanach/addNewSeries", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: `aliasId=sefarim&title=${encodeURIComponent(title)}&description=&heichel=tanach&parentSeriesId=${parentSeriesId}`,
    });
    const responseData = await response.json();
    if (responseData.error) {
        console.error('Error creating series:', responseData.error);
        return parentSeriesId; // Return parent series ID on error
    }
    return responseData.success.newSeriesID;
}

// Start the process
onclick = selectRootDirectory;

</script>