<!--B"H-->
<?Awtsmoos
    return await getT("bh.html")
  ?>
<style>
    
  .submit-post {
    background-color: #123456;
    color: white;
    padding: 15px;
    margin: 15px;
    border-radius: 8px;
  }

  .submit-post h2 {
    margin-top: 0;
  }

  .submit-form {
    display: flex;
    flex-direction: column;
  }

  .submit-form input, 
  .submit-form textarea, 
  .submit-form button,
  .submit-form select {
    margin-top: 10px;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ddd;
  }

  .submit-form button {
    background-color: #0a0;
    color: white;
    border: none;
    cursor: pointer;
  }

  .submit-form button:hover {
    background-color: #090;
  }

  select:required option[value=""] {
    display: none;
    }
</style>
<?Awtsmoos
//<script>
    console.log("HI",this.aliasIDs)
    if(!this.aliasIDs) {
        
        var bh = await getT("bh.html")
        olam.replace= /*html*/bh+`
            <br>
            <h4>You are not even logged in!
                <a href="/heichelos/${heichel}">Back to Heichel</a>
                <br>
                <a href="/login">Login</a>
                <br>
                <a href="/register">Create Account</a>
                </h4>
        `;
    }
//</script>
?>
<?Awtsmoos
var t = $_GET.type;
		console.log("ASD",t)
		if(t == "post" || t == "series") {
			$sd.type = t;
			$sd.ttitle = $sd.type[0]
			.toUpperCase() +
				$sd.type.substring(1);
			$sd.tdesc = $sd.type == "post" ? "content" 
			: "description";
		}
		var r = $_GET.returnURL;
		if(r) {
			return `<a class="r" href=${
				r
			}>Back to previous</a>`
		}
		
	?>
<div class="submit-post">
    
    <h2>Submit Your <?Awtsmoos return $sd.ttitle
	?></h2>
    <form class="submit-form" 
    id="formidable"
    action="/api/social/heichelos/<?Awtsmoos
        return heichel
    ?>/posts"
    method="POST">
      <select name="aliasId" required>
        <option value="">Select your alias</option>
        <?Awtsmoos
            //<script>
                var html = ""
                aliasIDs.forEach(w=> {
                    html += `<option value="${w.id}">
                        ${w.name}
                    </option>`
                })
                return html;
            //</script>
        ?>
      </select>
      <input type="text" placeholder="<?Awtsmoos return $sd.ttitle ?> Title" name="title" required>
      <textarea placeholder="Write your <?Awtsmoos return $sd.type ?> <?Awtsmoos
			return $sd.tdesc
		?> here..." name="<?Awtsmoos return $sd.tdesc ?>" required></textarea>
      <input type="hidden" name="heichel" value="<?Awtsmoos
      return heichel
      ?>">
      <?Awtsmoos
        var a=this.series;
        if(!a) return "";
        var h="";
        var sr=await fetchAwtsmoos(
        `/api/social/heichelos/${
        heichel

        }/series/${
        series

        }`

        );
        if(sr && !sr.error) {
        return "Adding to series: "+sr.name+
        /*html*/`<input type="hidden"
        name="seriesId" value="${series}">`;

        }
        

      ?>
        <br>
      <button type="submit">Submit Post</button>
    </form>
  </div>

  <script>
    formidable.onsubmit = submitForm;
    // This function will be called when you want to submit the form.
    function submitForm(event) {
    // Prevent the default form submission via the browser.
    event.preventDefault();

    // Get the form element (assuming the form has an id "myForm").
    const form = formidable

      
  // Create a URLSearchParams object.
  const params = new URLSearchParams();

    // For each form element, add its name and value to the params.
    Array.from(form.elements).forEach(element => {
    if (element.name && !element.disabled) {
        // Check if it's a checkbox/radio and if it's checked.
        if ((element.type !== 'checkbox' && element.type !== 'radio') || element.checked) {
        params.append(element.name, element.value);
        }
    }
    });

    // Use the fetch API to submit the form data.
    fetch(form.action, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: params
    })
    .then(response => {
        // Handle the response here. For example, you could convert it to JSON.
        if (!response.ok) {
        throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json(); // or .text() if the response is text and not JSON
    })
    .then(data => {
        if(data.error) {
            alert("There was a problem: "+data.error)
            return
        }
        alert("You just submitted the new entry: " + data.title);
        <?Awtsmoos 
            return "var heichel='"+heichel+"'"; 
        ?>
        location.href="/heichelos/"+heichel;
        // Handle the data from the response.
        console.log('Success:', data);
    })
    .catch((error) => {
        // Handle any errors here.
        console.error('Error:', error);
    });
    }

  </script>
