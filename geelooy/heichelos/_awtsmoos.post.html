<!--B"H-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awtsmoos POST | <?Awtsmoos
        return post.title
    ?></title>
    <link rel="stylesheet" href="/heichelos/new-style.css" type="text/css">

    <link rel="stylesheet" href="/style/home/main.css">
</head>

<body>
    
    <div class="all">
        <?<script> return $a("nav/header.html") 
        </script>?>
 <div class="main">
<div class="post-view">
    
   

    

    <div class="container">
        <div class="post">
            <div class="post-header">
                
                <div class="post-title">
                   <?Awtsmoos
                        return post.title
                    ?> 
                    <button id="minMax" class="button primary">A</button>

                    <button id="commentaryBtn" class="button third">+</button>
                </div>
                <div class="post-details hidden-details" id="postDetails">

                    
                    <div class="settings"> <!-- Controls for Text Size -->
                        <div class="controls">
                            <button onclick="adjustFontSize('increase')" class="button secondary">Increase Text Size</button>
                            <button onclick="adjustFontSize('decrease')" class="button secondary">Decrease Text Size</button>
                        </div>
                    </div>
                    
                </div>
                
                
                    
            </div>
            
            
            <div id="postFrame" class="post-frame">
                <div class="content"><?Awtsmoos 
                    return post.content 
                ?><?<script>
                        var html = "";
                    // var cur =  parseInt($_GET.currentIndex);
                        var myID = post.id;
                        var sr = $_GET.seriesParent;
                    
                        var posts = await fetchAwtsmoos(
                            `/api/social/heichelos/${
                                post.heichel.id
                            }/series/${
                                sr
                            }/posts`
                        );
                        var cur = posts.indexOf(myID);
                        var length = posts.length;
                        
                        var hasPrevious = cur > 0;
                        var hasNext = cur < length - 1;
                        var sr = $_GET.seriesParent;
                        
                        html +=/*html*/`
                            <div class="nav">
                        `

                        html+= /*html*/`
                            <div class="controls">${
                                cur + 1
                            } of ${
                                length
                            }    
                            </div>
                        `;
                        var last = encodeURIComponent(posts[cur-1]);
                        if(hasPrevious) {
                            html += /*html*/
                            `<a id="last" class="nav button primary" href="${last}">Previous</a>`
                        }

                        if(hasNext) {
                            var next = encodeURIComponent(posts[cur+1]);
                            html += /*html*/
                            `<a id="next" class="nav button primary"  href="${next}">Next</a>`
                        }

                        html += `</div>`;

                        html += /*html*/`
                            <script>

                                if(window.next) {
                                    next.href = next.href+"?"
                                    +(new URLSearchParams({
                                        currentIndex: "${cur+1}",
                                        path: "${$_GET.path}",
                                        seriesParent: "${$_GET.seriesParent}"
                                    }));
                                }

                                if(window.last) {
                                    last.href = last.href+"?"
                                        +(new URLSearchParams({
                                        currentIndex: "${cur-1}",
                                        path: "${$_GET.path}",
                                        seriesParent: "${$_GET.seriesParent}"
                                    }));
                                }
                            </script>
                        `
                        return html;
                        
                    
                    
                </script>?>
                </div>
                <div class="sidebar hidden-comments">
                    <div class="tab-buttons">
                        <div class="tab-button" id="postInfoBtn">Post Info</div>
                    </div>
                    <div class="all-tabs">
                        <div class="tab-container" id="postInfo">
                            <div class="post-info">
                                <div class="back-btn" id="postBack">Back</div>
                                <div class="info-header">Post Info</div>
                            <div class="tl post-author"><div class="label">Author:</div>
                            <div class="value"><a href="/@<?Awtsmoos
                                return alias.id    
                            ?>"><?Awtsmoos
                                return alias.name
                            ?></a></div></div>
                            <div class="tl post-heichel-name"><div class="label">Heichel Name:</div>
                            <div class="value"><a href="/heichelos/<?Awtsmoos
                                return post.heichel.id
                            ?>"><?Awtsmoos
                                return post.heichel.name
                            ?></a></div></div>
                            <?<script>
                                var sr = $_GET.seriesParent;
                                try {
                                    var bp = $_GET.basepath;
                                    
                                    var seriesDetails = await fetchAwtsmoos(
                                        `/api/social/heichelos/${
                                            post.heichel.id
                                        }/series/${
                                            sr
                                        }/`
                                    );
                                    sr = seriesDetails
                                
                                    
                                    return /*html*/`
                                        <div class="tl post-parent-series">
                                            <div class="label">Part of Series:</div>
                                            <div class="value"><a href="/heichelos/${
                                                post.heichel.id   
                                            }/#?series=${
                                                sr.id
                                            }&path=${
                                                encodeURIComponent(
                                                    $_GET.path
                                                )
                                            }">${sr.prateem.name}</a>
                                        </div>
                                        </div>
                                    `
                                } catch(e){
                                    console.log(e)
                                }
                                return "ASDF"
                            </script>?>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
            
            
            <script>
                 
                console.log("B\"H")
                var postElement = postFrame;
                var MAX_FONT_SIZE = 45;  // Define the max font size
                var MIN_FONT_SIZE = 10;  // Define the min font size
                var FONT_SIZE_INCREMENT = 2; // Define the size increment
                var postElement;
                function adjustFontSize(action) {
                    if(!postElement)
                        postElement = document.querySelector('.content');
                    let currentFontSize = window.getComputedStyle(postElement, null).getPropertyValue('font-size');
                    currentFontSize = parseFloat(currentFontSize);
                
                    if(action =='increase' && currentFontSize < MAX_FONT_SIZE) {
                        postElement.style.fontSize = (currentFontSize + FONT_SIZE_INCREMENT) + 'px';
                    } else if(action === 'decrease' && currentFontSize > MIN_FONT_SIZE) {
                        postElement.style.fontSize = (currentFontSize - FONT_SIZE_INCREMENT) + 'px';
                    }
        
                    localStorage.currentFontSize = currentFontSize;
                   // sendSizeMessage()
                }

                function loadFontSize() {
                    if(!postElement)
                        postElement = document.querySelector('.content');
                    if(!postElement) {
                        return;
                    }
                    var fs = localStorage.currentFontSize;
                    if(!fs) return;
                    var num = parseInt(fs);
                    if(isNaN(num)) return;
                    postElement.style.fontSize = num +"px";

                }

                onload = () => {
                    loadFontSize()
                }


            
            
        
                var hidSettings = true;
                var hidCom = true;
                var sidebar = document.querySelector(".sidebar");
                var postInfo = document.querySelector("#postInfo")
                var allTabs = document.querySelector(".all-tabs");
                var allTabBtns = document.querySelector(".tab-buttons");
                minMax.onclick = () => {
                    postFrame.classList.toggle("with-details")
                    postDetails.classList.toggle("hidden-details")
                    hidSettings = !hidSettings;
                 //   minMax.textContent = hid ? "+" : "-"
                }
                commentaryBtn.onclick = () => {
                    hidCom = !hidCom;
                    commentaryBtn.innerHTML = hidCom ? "+" : "-";
                    sidebar.classList.toggle("hidden-comments")
                }


                postInfoBtn.onclick = () => {
                    if(!postInfo) return;
                    allTabBtns.classList.add("invisible")
                    allTabs.classList.add("active");
                    postInfo.classList.add("active")
                }

                postBack.onclick = () => {
                    if(!postInfo) return;
                    postInfo.classList.remove("active");
                    allTabs.classList.add("active");
                    allTabBtns.classList.remove("invisible")
                }

                function addTab({
                  
                    header,
                    content
                }) {
                    if(
                        !sidebar ||
                        !allTabs ||
                        !allTabBtns
                    ) return;
                    var btn =document.createElement("div");
                    btn.className = "tab-button"
                    allTabBtns.appendChild(btn);
                    btn.textContent = header;

                    var tab = document.createElement("div");
                    tab.className="tab-container";
                    allTabs.appendChild(tab);

                    var info  =document.createElement("div")
                    info.className="post-info";
                    tab.appendChild(info)

                    var bck = document.createElement("div");
                    bck.className = "back-btn";
                    bck.textContent = "Back";
                    info.appendChild(bck);

                    var hdr = document.createElement("div");
                    hdr.className = "info-header";
                    hdr.textContent = header;
                    info.appendChild(hdr);

                    var actualTab = document.createElement("div");
                    actualTab.className = "tab-content";
                    
                    actualTab.innerHTML = content;
                    info.appendChild(actualTab);
                    var tabHidden = true;
                    btn.onclick = () => {  
                       
                        allTabBtns.classList.remove("invisible")
                        allTabs.classList.remove("active");
                        tab.classList.remove("active");
                        
                    }
                }

                addTab({
                    header: "Connections",
                    content: "Coming soon iy\"H!"
                })
                function addSidebarNav() {
                   

                    

                }
            </script>

    
        </div>
    </div>

    </div>
    </div>
</div>
</body>

</html>
